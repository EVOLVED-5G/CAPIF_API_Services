[**[Return To All Test Plans]**]

- [Test Plan for CAPIF Api Invoker Management](#test-plan-for-capif-api-invoker-management)
- [Tests](#tests)
  - [Test Case 1: Register NetApp](#test-case-1-register-netapp)
  - [Test Case 2: Register NetApp Already registered](#test-case-2-register-netapp-already-registered)
  - [Test Case 3: Update Registered NetApp](#test-case-3-update-registered-netapp)
  - [Test Case 4: Update Not Registered NetApp](#test-case-4-update-not-registered-netapp)
  - [Test Case 5: Delete Registered NetApp](#test-case-5-delete-registered-netapp)
  - [Test Case 6: Delete Not Registered NetApp](#test-case-6-delete-not-registered-netapp)


# Test Plan for CAPIF Api Invoker Management
At this documentation you will have all information and related files and examples of test plan for this API.

# Tests

## Test Case 1: Register NetApp
* Test ID: ***capif_api_invoker_management-1***
* Description:

  This test will try to register new NetApp at CAPIF Core
* Pre-Conditions:

  * NetApp was not registered previously
  * NetApp was not onboarded previously
* Information of Test:

  1. Create public and private key at invoker

  2. Register of Invoker at CCF:
     * Send POST to http://{CAPIF_HOSTNAME}:{CAPIF_PORT}/register 
     * body [invoker register body]

  3. Onboard Invoker:
     * Send POST to https://{CAPIF_HOSTNAME}/api-invoker-management/v1/onboardedInvokers
     * Reference Request Body: [request body]
     * "onboardingInformation"->"apiInvokerPublicKey": must contain public key generated by Invoker.

* Execution Steps:
  
  1. Register Invoker at CCF
  2. Onboard Invoker at CCF
  3. Store signed Certificate
   
* Expected Result:
  
  1. NetApp must receive **201 Created**
  2. Response Body must accomplish with **APIInvokerEnrolmentDetails** data structure
  3. Response body must contain:
     * apiInvokerId created.
     * onboardingInformation->apiInvokerCertificate must contain the public key signed.
  4. Response Header **Location** must be received with URI to new resource created, following this structure: *{apiRoot}/api-invoker-management/<apiVersion>/onboardedInvokers/{onboardingId}*
* Current Status:
  
  **Passed**


## Test Case 2: Register NetApp Already registered
  
  This test case will check that a NetApp previously registered canot be re-registered

* Pre-Conditions:
  
  NetApp was registered previously and there is a {onboardingId} for his NetApp in the DB

* Actions:

  Register NetApp
  
  Request Body: [request body]

* Post-Conditions:
  
  403 Forbidden returned.

## Test Case 3: Update Registered NetApp  
  
  This test case will check that a Registered NetApp can be updated  

* Pre-Conditions:
  
  NetApp was registered previously and there is a {onboardingId} for his NetApp in the DB

* Actions:

  Update NetApp onboardingDetails
  
  Request Body: [request body]

* Post-Conditions:
  
  200 API invoker details updated successfully.

## Test Case 4: Update Not Registered NetApp 
  
  This test case will check that a Non-Registered NetApp cannot be updated  

* Pre-Conditions:
  
  NetApp was not registered previously.

* Actions:

  Update NetApp onboardingDetails
  
  Request Body: [request body]

* Post-Conditions:
  
  404 Not found.

## Test Case 5: Delete Registered NetApp   
  
  This test case will check that a Registered NetApp can be deleted  

* Pre-Conditions:
  
  NetApp was registered previously.

* Actions:

  Delete NetApp 
  
  Request Body: [request body]

* Post-Conditions:
  
  204 The individual API Invoker matching onboardingId was offboarded.

## Test Case 6: Delete Not Registered NetApp 
  
  This test case will check that a Non-Registered NetApp cannot be deleted  

* Pre-Conditions:
  
  NetApp was not registered previously.

* Actions:

  Delete NetApp 
  
  Request Body: [request body]

* Post-Conditions:
  
  404 Not Found.



[request body]: ./invoker_details_post_example.json  "API Invoker Request"
[invoker register body]: ./invoker_register_body.json  "Invoker Register Body"

[Return To All Test Plans]: ../README.md